#!/usr/bin/env ruby
# frozen_string_literal: true

require "bundler/setup"
require "stretchy"
require "irb"

banner = <<~BANNER

                                                d8b                
           d8P                     d8P          ?88                
        d888888P                d888888P         88b               
 .d888b,  ?88'    88bd88b d8888b  ?88'   d8888b  888888b ?88   d8P 
 ?8b,     88P     88P'  `d8b_,dP  88P   d8P' `P  88P `?8bd88   88  
   `?8b   88b    d88     88b      88b   88b     d88   88P?8(  d88  
`?888P'   `?8b  d88'     `?888P'  `?8b  `?888P'd88'   88b`?88P'?8b 
                                                                )88
                                                               ,d8P
                                                            `?888P'
BANNER

print Rainbow(banner).red
print "\t    " * 7
print Rainbow(" v#{Stretchy::VERSION}").white.faint
print "\n\n"

ActiveSupport::Notifications.subscribe 'search.elasticsearch' do |name, start, finish, id, payload|
   message = [
      Rainbow("  #{payload[:klass]}").bright, 
      "(#{(finish.to_time - start.to_time).round(2)}ms)",
      Stretchy::Utils.to_curl(payload[:klass].constantize, payload[:search])
   ].join(" ")
   Stretchy.logger.debug(Rainbow(message).color(:yellow))
end

IRB.start(__FILE__)


